<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AutoCare Plus | Staff Live Board</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== GLOBAL ===== */
body{
  margin:0;
  font-family:Segoe UI,sans-serif;
  color:white;
  background:#020617;
  overflow:hidden;
}

/* ===== RACING BACKGROUND ===== */
.race-bg{
  position:fixed;
  inset:0;
  z-index:-2;
  background:radial-gradient(circle at top,#020617,#000);
}
.road{
  position:absolute;
  bottom:0;
  width:300%;
  height:45%;
  background:repeating-linear-gradient(
    90deg,#111 0,#111 60px,#eee 60px,#eee 120px);
  opacity:.35;
}
.car{
  position:absolute;
  bottom:18%;
  font-size:64px;
  filter:drop-shadow(0 10px 30px rgba(0,0,0,.9));
}
.car1{ bottom:20% }
.car2{ bottom:26%; font-size:56px }
.car3{ bottom:14%; font-size:60px }
.headlight{
  position:absolute;
  bottom:22%;
  width:160px;
  height:40px;
  background:radial-gradient(circle,#fff,#fde68a,transparent);
  filter:blur(14px);
  opacity:.6;
}
.sparks{
  position:absolute;
  bottom:16%;
  left:50%;
  width:6px;height:6px;
  background:#facc15;
  box-shadow:0 0 10px #facc15,10px 6px 12px #fb7185;
  border-radius:50%;
  animation:spark .15s infinite alternate;
}
@keyframes spark{to{transform:translateY(-6px);opacity:.3}}

body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.75);
  z-index:-1;
}

/* ===== BOARD ===== */
h2{text-align:center;margin:15px}
.board{
  display:flex;
  gap:14px;
  padding:20px;
}
.col{
  width:20%;
  background:#0f172a;
  border-radius:16px;
  padding:14px;
}
.job{
  background:#1e293b;
  padding:12px;
  margin:10px 0;
  border-radius:12px;
}
button{
  width:100%;
  margin-top:6px;
  background:#38bdf8;
  border:none;
  padding:6px;
  border-radius:8px;
  cursor:pointer;
}
small{color:#94a3b8}
</style>
</head>

<body>

<!-- Racing Background -->
<div class="race-bg">
  <div class="road"></div>
  <div class="car car1">üèéÔ∏è</div>
  <div class="car car2">üöó</div>
  <div class="car car3">üöô</div>
  <div class="headlight"></div>
  <div class="sparks"></div>
</div>

<h2>üîß AutoCare Live Job Board</h2>
<div class="board" id="board"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, onSnapshot,
  updateDoc, doc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey: "AIzaSyD9cPmUCMEtT7XukcAxmeS50jKh1A2f31Q",
  authDomain: "auto-care-plus-e7fdf.firebaseapp.com",
  projectId: "auto-care-plus-e7fdf",
  storageBucket: "auto-care-plus-e7fdf.firebasestorage.app",
  messagingSenderId: "746107164946",
  appId: "1:746107164946:web:5951433bf11f0cadedfbcb"
});
const db = getFirestore(app);

/* Board */
const stages=["NEW","INSPECTION","REPAIR","QUALITY_CHECK","READY"];
board.innerHTML = stages.map(s=>`
<div class="col"><h3>${s}</h3><div id="${s}"></div></div>
`).join("");

onSnapshot(collection(db,"jobs"),snap=>{
  stages.forEach(s=>document.getElementById(s).innerHTML="");

  snap.forEach(d=>{
    const j=d.data();
    const div=document.createElement("div");
    div.className="job";
    div.innerHTML=`
      <b>${j.vehicleNumber}</b><br>
      ${j.customerName}<br>
      <small>${j.createdAt?.toDate().toLocaleString()}</small>
      ${j.status!=="READY"
        ? `<button onclick="nextStage('${d.id}','${j.status}')">Next</button>`
        : ""}
    `;
    document.getElementById(j.status).appendChild(div);
  });
});

/* Status update */
window.nextStage=async(id,status)=>{
  const i=stages.indexOf(status);
  if(i<stages.length-1){
    await updateDoc(doc(db,"jobs",id),{
      status:stages[i+1],
      completedAt:stages[i+1]==="READY"?serverTimestamp():null
    });
  }
};

/* ===== REAL-TIME SPEED ENGINE ===== */
let speed=12;
const cars=document.querySelectorAll(".car");
const road=document.querySelector(".road");

const style=document.createElement("style");
style.innerHTML=`
@keyframes drive{
  0%{transform:translateX(-20vw) scaleX(1)}
  45%{transform:translateX(120vw) scaleX(1)}
  50%{transform:translateX(120vw) scaleX(-1)}
  95%{transform:translateX(-20vw) scaleX(-1)}
  100%{transform:translateX(-20vw) scaleX(1)}
}
@keyframes roadMove{to{transform:translateX(-50%)}}
`;
document.head.appendChild(style);

function applySpeed(){
  cars.forEach((c,i)=>{
    c.style.animation=`drive ${speed+i*2}s linear infinite`;
  });
  road.style.animation=`roadMove ${speed/4}s linear infinite`;
}
applySpeed();

/* Firestore ‚Üí speed */
onSnapshot(collection(db,"jobs"),snap=>{
  let load=0;
  snap.forEach(d=>{
    if(["REPAIR","QUALITY_CHECK"].includes(d.data().status)) load++;
  });
  speed=Math.max(6,16-load);
  applySpeed();
});
</script>

</body>
</html>
